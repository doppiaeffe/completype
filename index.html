<html>
    <body>

        <a>LISTA UTENTI IN ATTESA</a>
        <br><br>
        <div id="utenti">

        </div>

        <script>
            //var remoteIP = "http://localhost:8080/users"
            var remoteIP = "https://completype-android.herokuapp.com/users"

            function httpGet(theUrl, callback)
            {
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() { 
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                        callback(xmlHttp.responseText);
                }
                xmlHttp.open("GET", theUrl, true); // true for asynchronous 
                xmlHttp.send(null);
            }

            setInterval(function()
            {
                httpGet(remoteIP,function(ret)
                {
                    var retP = JSON.parse(ret)
                    var listaConnessi = retP.waiting;
                    var listDom = document.querySelectorAll("#connessi");

                    console.log(retP)

                    for(var n=0; n<listDom.length; n++)
                    {
                        var curr = listDom[n];
                        var present = false

                        for(var i=0; i<listaConnessi.length; i++)
                        {
                            var id = listaConnessi[i]

                            if(curr.innerHTML == id)
                            {
                                present = true
                                listaConnessi[n] = null
                            }      
                        }

                        if (present == false)
                            curr.parentElement.removeChild(curr)
                    }

                    for(var i=0; i<listaConnessi.length; i++)
                    {
                        var id = listaConnessi[i]

                        if(id != null)
                        {
                            var newDiv = document.createElement("div"); 
                            newDiv.id = "connessi"
                            newDiv.innerHTML = id
                            document.querySelector("#utenti").appendChild(newDiv);
                        }      
                    }

                    

                })
            },100)
        </script>

    </body>
</html>